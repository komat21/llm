<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>最新ニュース一覧</title>
<style>
body { font-family: sans-serif; margin:20px; background:#f4f4f9; }
.container { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:8px; }
h1 { border-bottom:2px solid #333; padding-bottom:10px; }
ol, ul { list-style:none !important; padding-left:0 !important; margin-left:0 !important; }
li::marker { content:"" !important; }
.news-item { border:1px solid #ddd; padding:15px; margin-bottom:15px; border-radius:6px; }
.news-item h2 { margin:0 0 6px 0; font-size:1.1em; }
.news-item p { color:#555; font-size:0.9em; }
.tags { margin-top:8px; }
.tag { display:inline-block; background:#007bff; color:#fff; padding:4px 8px; margin-right:5px; border-radius:12px; font-size:0.8em; }
</style>
</head>
<body>
<div class="container">
<h1>最新ニュース一覧</h1>

<label>カテゴリ：</label>
<select id="category-select">
  <option disabled selected>カテゴリを選択</option>
  {% for c in categories %}<option value="{{ c }}">{{ c }}</option>{% endfor %}
</select>

<div id="news-list"></div>
</div>

<script>
const newsList = document.getElementById("news-list");
const select = document.getElementById("category-select");
let isLoading = false;

function fetchNews() {
  if (isLoading) return;
  const cat = select.value;
  if (!cat) return;

  isLoading = true;
  newsList.innerHTML = "<p>読み込み中…</p>";

  fetch(`/api/news/${cat}`)
    .then(r => r.json())
    .then(d => render(d.news))
    .finally(() => isLoading = false);
}

function render(items) {
  if (!items || items.length === 0) {
    newsList.innerHTML = "<p>ニュースがありません</p>";
    return;
  }
  let html = "<ul>";
  items.forEach(it => {
    html += `
      <li>
        <div class="news-item">
          <h2><a href="${it.link}" target="_blank" rel="noopener">${it.title}</a></h2>
          <p>${it.summary ? it.summary.slice(0,150) + "…" : ""}</p>
          <div class="tags">
            ${(it.tags || []).map(t => `<span class="tag">${t}</span>`).join("")}
          </div>
        </div>
      </li>`;
  });
  html += "</ul>";
  newsList.innerHTML = html;
}

select.addEventListener("change", fetchNews);
</script>
</body>
</html>
